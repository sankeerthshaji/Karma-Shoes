<%- include('../partials/adminPartials/adminPartial.ejs') %>
  <body>
    <div class="container-fluid">
      <div class="row flex-nowrap">
        <div
          class="col-auto col-md-3 col-xl-2 px-sm-2 px-0"
          style="background-color: #343a40"
        >
          <div
            class="d-flex flex-column align-items-center align-items-sm-start px-3 pt-2 text-white min-vh-100"
          >
            <a
              href="/admin/"
              class="d-flex align-items-center pb-3 mb-md-0 me-md-auto text-white text-decoration-none"
            >
              <span class="fs-5 d-none d-sm-inline">Admin</span>
            </a>
            <ul
              class="nav nav-pills flex-column mb-sm-auto mb-0 align-items-center align-items-sm-start"
              id="menu"
            >
              <li>
                <a href="/admin/adminDashboard" class="nav-link align-middle px-0">
                  <img
                    src="/img/admin/dashboard.svg"
                    alt=""
                    style="width: 1rem"
                  /><span class="ms-1 d-none d-sm-inline">Dashboard</span>
                </a>
              </li>
              <li>
                <a href="/admin/orders" class="nav-link px-0 align-middle">
                  <img
                    src="/img/admin/orders.svg"
                    alt=""
                    style="width: 1rem"
                  /><span class="ms-1 d-none d-sm-inline">Orders</span></a
                >
              </li>
              <li>
                <a href="/admin/products" class="nav-link px-0 align-middle">
                  <img
                    src="/img/admin/products.svg"
                    alt=""
                    style="width: 1rem"
                  /><span class="ms-1 d-none d-sm-inline">Products</span></a
                >
              </li>
              <li>
                <a href="/admin/addProducts" class="nav-link px-0 align-middle">
                  <img
                    src="/img/admin/add products.svg"
                    alt=""
                    style="width: 1rem"
                  />
                  <span class="ms-1 d-none d-sm-inline">Add Products</span></a
                >
              </li>
              <li>
                <a href="/admin/Categories" class="nav-link px-0 align-middle">
                  <img
                    src="/img/admin/category.svg"
                    alt=""
                    style="width: 1rem"
                  />
                  <span class="ms-1 d-none d-sm-inline">Categories</span></a
                >
              </li>
              <li>
                <a href="/admin/addCategory" class="nav-link px-0 align-middle">
                  <img
                    src="/img/admin/add category.svg"
                    alt=""
                    style="width: 1rem"
                  />
                  <span class="ms-1 d-none d-sm-inline">Add Category</span></a
                >
              </li>
              <li>
                <a href="/admin/coupons" class="nav-link px-0 align-middle">
                  <img
                    src="/img/admin/coupon.svg"
                    alt=""
                    style="width: 1rem"
                  />
                  <span class="ms-1 d-none d-sm-inline">Coupons</span></a
                >
              </li>
              <li>
                <a href="/admin/addCoupon" class="nav-link px-0 align-middle">
                  <img
                    src="/img/admin/addCoupon.svg"
                    alt=""
                    style="width: 1rem"
                  />
                  <span class="ms-1 d-none d-sm-inline">Add Coupon</span></a
                >
              </li>
              <li>
                <a href="/admin/userDetails" class="nav-link px-0 align-middle">
                  <img src="/img/admin/users.svg" alt="" style="width: 1rem" />
                  <span class="ms-1 d-none d-sm-inline">Users</span>
                </a>
              </li>
              <li>
                <a href="/admin/logout" class="nav-link px-0 align-middle">
                  <img src="/img/admin/exit.svg" alt="" style="width: 1rem" />
                  <span class="ms-1 d-none d-sm-inline">Logout</span>
                </a>
              </li>
            </ul>
            <hr />
          </div>
        </div>
        <div class="col py-3">
          <section>
            <div class="container mt-4">
              <div class="row">
                <div class="col-md-6">
                  <h2 class="text-center">Edit product</h2>
                  <form
                    action="/admin/products/<%=product._id%>?_method=PUT"
                    method="post"
                    enctype="multipart/form-data"
                  >
                    <label for="name">Name</label>
                    <input
                      type="text"
                      name="name"
                      id="name"
                      value="<%= product.name %>"
                      class="form-control"
                      required
                    />

                    
                    <label for="price">Price</label>
                    <input
                      type="number"
                      name="price"
                      id="price"
                      value="<%= product.price %>"
                      class="form-control"
                      required
                    />

                    <label for="description">Description</label>
                    <input
                      type="text"
                      name="description"
                      id="description"
                      value="<%= product.description %>" 
                      class="form-control"
                      required
                    />

                    <label for="category">Category</label>
                    <select name="category" id="category" class="form-control">
                        <% for(let category of categories) { %> 
                          <% if(category.isActive === true) { %>
                        <option value="<%= category._id %>" <%= product.category.name === category.name ? 'selected' : '' %>><%= category.name %></option>
                        <% } %> 
                        <% } %> 
                    </select>

                    <label for="image">Add more Images</label>
                    <input
                      type="file"
                      name="image"
                      id="image"
                      class="form-control"
                      accept="image/*"
                      multiple
                    />

                    <div class="mt-3" style="display: flex; flex-wrap: wrap;">
                      <% product.images.forEach(function(image,i){ %>
                        <div style="display: flex; flex-direction: column; align-items: center; width: 30%;">
                          <img src="<%= image.url %>" alt="<%= image.filename %>" style="width: 10rem; height: 10rem;" />
                          <label>
                            <input type="checkbox" name="deleteImages" value="<%= image.filename %>" style="margin-top: 10px;" />
                            Delete
                          </label>
                        </div>
                      <% }) %> 
                    </div>
        
                    <button type="submit" class="btn btn-dark mt-4">
                      Update
                    </button>
                  </form>
                </div>
              </div>
            </div>
          </section>
        </div>
      </div>
    </div>

    <!-- <script>
      function viewImage(event){
        document.getElementById('imgView').src=URL.createObjectURL(event.target.files[0])
      }
    </script> -->

    <script>
      const menuLinks = document.querySelectorAll("#menu a.nav-link");
      const currentUrl = window.location.pathname;
  
      menuLinks.forEach((link) => {
        if (link.getAttribute("href") === currentUrl) {
          link.setAttribute("style", "color: white; text-decoration: none;");
        }
      });
    </script>
  </body>
